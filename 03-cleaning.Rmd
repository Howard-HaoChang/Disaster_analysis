# Data transformation

```{r,echo=FALSE, message=FALSE, results='hide'}
library(tidyverse)
library(countrycode)
```

## Read GDP data
```{r}
df_covid_raw = read.csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv')
covid_df = df_covid_raw %>% select(-(1:4)) 
covid_df = cbind("Country.Region" = df_covid_raw$Country.Region, 
                 "Total.Death" = rowSums(covid_df)) %>% data.frame()
covid_df = covid_df %>% mutate("Total.Death" = as.numeric(Total.Death)) %>% 
  group_by(Country.Region) %>% 
  summarise("Total.Death" = sum(Total.Death, na.rm = T))
head(covid_df)
```

```{r}
countryname(unique(covid_df$Country.Region))
countryname(unique(disaster))
```
Warning in countrycode_convert(sourcevar = sourcevar, origin = origin, destination = dest,  :
  Some values were not matched unambiguously: Diamond Princess, Micronesia, MS Zaandam, Summer Olympics 2020, Winter Olympics 2022
  
```{r}
#remove Summer Olympics 2020 & Winter Olympics 2022,Micronesia
covid_remove <- covid_df[-which(covid_df$Country.Region %in% c("Summer Olympics 2020", "Winter Olympics 2022", "Micronesia")),]
#Diamond Princess - Japan
covid_remove$Country.Region[covid_remove$Country.Region == "Diamond Princess"] <- "Japan"
#MS Zaandam - Netherlands
covid_remove$Country.Region[covid_remove$Country.Region == "MS Zaandam"] <- "Netherlands"
```

```{r}
GDP = read.csv("data/world_bank_gdp.csv")
```

```{r}
countryname(unique(GDP$Country.Name))
```

```{r}
raw_data <- readxl::read_xlsx("data/disaster data.xlsx")
data_temp <- raw_data
latitude.longtitude.data <- map_data("world")
```

```{r}
countryname(unique(data_temp$Country))
countryname(unique(latitude.longtitude.data$region))
```
Warning in countrycode_convert(sourcevar = sourcevar, origin = origin, destination = dest,  :
  Some values were not matched unambiguously: Azores Islands, Canary Is, Serbia Montenegro, Yemen P Dem Rep

Warning in countrycode_convert(sourcevar = sourcevar, origin = origin, destination = dest,  :
  Some values were not matched unambiguously: Ascension Island, Azores, Barbuda, Canary Islands, Chagos Archipelago, Grenadines, Heard Island, Madeira Islands, Micronesia, Saba, Saint Martin, Siachen Glacier, Sint Eustatius, Virgin Islands

```{r}
#remove the country names: "Micronesia (Federated States of)","Tuvalu"
data_remove <- data_temp[-which(data_temp$Country %in% c("Micronesia (Federated States of)","Tuvalu")),]
##replace the country names
#Azores Islands - Azores
data_remove$Country[data_remove$Country == "Azores Islands"] <- "Azores"
#Canary Is - Canary Islands
data_remove$Country[data_remove$Country == "Canary Is"] <- "Canary Islands"
#Yemen P Dem Rep & Yemen Arab Rep - Yemen
data_remove$Country[data_remove$Country %in% c("Yemen P Dem Rep","Yemen Arab Rep")] <- "Yemen"
#Virgin Island (British) - Virgin Islands
data_remove$Country[data_remove$Country == "Virgin Island (British)"] <- "Virgin Islands"
#Virgin Island (U.S.) - Virgin Islands
data_remove$Country[data_remove$Country == "Virgin Island (U.S.)"] <- "Virgin Islands"
#Hong Kong - China
data_remove$Country[data_remove$Country == "Hong Kong"] <- "China"
#Macao - China
data_remove$Country[data_remove$Country == "Macao"] <- "China"
#Netherlands Antilles - Netherlands
data_remove$Country[data_remove$Country == "Netherlands Antilles"] <- "Netherlands"
#Saint Martin (French Part) - Saint Martin
data_remove$Country[data_remove$Country == "Saint Martin (French Part)"] <- "Saint Martin"
#Tokelau - New Zealand
data_remove$Country[data_remove$Country == "Tokelau"] <- "New Zealand"
```

```{r}
names(disaster_match)
disaster <- disaster_match %>%
  select("Year","Disaster Group","Disaster Subgroup","Disaster Type","Disaster Subtype","Country","ISO","Region",
         "Continent","Total Deaths","Total Damages ('000 US$)","Total Damages, Adjusted ('000 US$)")

colnames(disaster) <- c("Year","Disaster Group","Disaster Subgroup","Disaster Type","Disaster Subtype","Country","ISO","Region","Continent","Total Deaths","Total Damages","Total Damages Adjusted")
```